{# def
    campaign:Campaign,
    books:List[CampaignBook],
    CampaignEditableInfo: CampaignEditableInfo,
    can_manage_campaign: bool = False,
    table_type_note: TableType,
    table_type_chapter: TableType,
#}

{% if can_manage_campaign %}
    <button class="btn btn-outline-primary btn-sm ms-3 float-end"
            hx-get="{{ url_for(CampaignEditableInfo.BOOK.value.route, campaign_id=campaign.id) }}"
            hx-trigger="click"
            hx-target="#{{ CampaignEditableInfo.BOOK.value.div_id }}"
            hx-swap="innerHTML">Add Book</button>
{% endif %}
<h2>Books & Chapters</h2>
<hr class="border border-primary border-2 opacity-75">
{# We need the three divs to target HTMX partials above the entire accordion display #}
<div id="{{ CampaignEditableInfo.BOOK.value.div_id }}">

    <global.AccordionGroup name="bookAccordion">
    {% for book in books | sort(attribute="number") %}
        <global.AccordionItem accordion-name="bookAccordion" title={{ book.number ~ '. ' ~ book.name }} index={{ loop.index }}>

        {% if can_manage_campaign %}
            <div class="btn-group float-end">
                <button class="btn btn-sm btn-outline-primary"
                        style="--bs-btn-padding-y: .25rem;
                               --bs-btn-padding-x: .5rem;
                               --bs-btn-font-size: .75rem"
                        hx-get="{{ url_for(CampaignEditableInfo.BOOK.value.route, campaign_id=campaign.id, book_id=book.id) }}"
                        hx-trigger="click"
                        hx-target="#{{ CampaignEditableInfo.BOOK.value.div_id }}"
                        hx-swap="innerHTML">Edit</button>
                <button class="btn btn-sm btn-outline-danger"
                        style="--bs-btn-padding-y: .25rem;
                               --bs-btn-padding-x: .5rem;
                               --bs-btn-font-size: .75rem"
                        hx-delete="{{ url_for(CampaignEditableInfo.BOOK.value.route, campaign_id=campaign.id, book_id=book.id) }}"
                        hx-trigger="click"
                        hx-target="#{{ CampaignEditableInfo.BOOK.value.div_id }}"
                        hx-swap="innerHTML">Delete</button>
            </div>
        {% endif %}
        <h2>{{ book.number }}. {{ book.name | escape }}</h2>
        <hr class="border border-primary border-1 opacity-75">
        <div class="mb-5">{{ book.description_long | from_markdown | safe }}</div>

        <HTMXPartials.EditTable.TablePartial TableType={{ table_type_note }} items={{ book.notes }} can_edit={{ can_manage_campaign }} parent_id={{ book.id }} header_size="h4" />

        <HTMXPartials.EditTable.TablePartial TableType={{ table_type_chapter }} items={{ book.chapters }} can_edit={{ can_manage_campaign }} parent_id={{ book.id }} header_size="h4" />

        </global.AccordionItem>
    {% endfor %}
    </global.AccordionGroup>

</div>
